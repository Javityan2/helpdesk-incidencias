<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <p>Bienvenido, {{ currentUser?.nombre }} {{ currentUser?.apellido }}</p>
  </div>

  <div *ngIf="loading" class="loading-section">
    <app-loading message="Cargando estadísticas..."></app-loading>
  </div>

  <div *ngIf="!loading && stats" class="dashboard-content">
    <!-- Tarjetas de estadísticas -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">bug_report</mat-icon>
            <h3>Total Incidencias</h3>
          </div>
          <div class="stat-value">{{ stats.total }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon" style="color: #ff9800;">pending</mat-icon>
            <h3>Abiertas</h3>
          </div>
          <div class="stat-value">{{ stats.abiertas }}</div>
          <div class="stat-percentage">
            {{ getProgressPercentage(stats.abiertas, stats.total) }}%
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon" style="color: #2196f3;">engineering</mat-icon>
            <h3>En Proceso</h3>
          </div>
          <div class="stat-value">{{ stats.enProceso }}</div>
          <div class="stat-percentage">
            {{ getProgressPercentage(stats.enProceso, stats.total) }}%
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon" style="color: #4caf50;">check_circle</mat-icon>
            <h3>Resueltas</h3>
          </div>
          <div class="stat-value">{{ stats.resueltas }}</div>
          <div class="stat-percentage">
            {{ getProgressPercentage(stats.resueltas, stats.total) }}%
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Gráficos de prioridad -->
    <div class="charts-section">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Distribución por Prioridad</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="priority-chart">
            <div class="priority-item">
              <div class="priority-label">
                <span class="priority-dot" style="background-color: #f44336;"></span>
                Alta
              </div>
              <div class="priority-bar">
                <div class="priority-fill" 
                     [style.width.%]="getProgressPercentage(stats.alta, stats.total)"
                     style="background-color: #f44336;">
                </div>
              </div>
              <div class="priority-count">{{ stats.alta }}</div>
            </div>

            <div class="priority-item">
              <div class="priority-label">
                <span class="priority-dot" style="background-color: #ff9800;"></span>
                Media
              </div>
              <div class="priority-bar">
                <div class="priority-fill" 
                     [style.width.%]="getProgressPercentage(stats.media, stats.total)"
                     style="background-color: #ff9800;">
                </div>
              </div>
              <div class="priority-count">{{ stats.media }}</div>
            </div>

            <div class="priority-item">
              <div class="priority-label">
                <span class="priority-dot" style="background-color: #4caf50;"></span>
                Baja
              </div>
              <div class="priority-bar">
                <div class="priority-fill" 
                     [style.width.%]="getProgressPercentage(stats.baja, stats.total)"
                     style="background-color: #4caf50;">
                </div>
              </div>
              <div class="priority-count">{{ stats.baja }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Acciones rápidas -->
    <div class="quick-actions">
      <mat-card class="actions-card">
        <mat-card-header>
          <mat-card-title>Acciones Rápidas</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="actions-grid">
            <button mat-raised-button color="primary" routerLink="/incidencias/nueva">
              <mat-icon>add</mat-icon>
              Nueva Incidencia
            </button>
            <button mat-raised-button color="accent" routerLink="/incidencias">
              <mat-icon>list</mat-icon>
              Ver Todas
            </button>
            <button mat-raised-button color="warn" routerLink="/incidencias">
              <mat-icon>priority_high</mat-icon>
              Urgentes
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div> 